%% Run visGUI
clear
close all
delete(timerfind)

addpath(genpath('dependencies'))
addpath(genpath('utility'))
addpath('vis')

playback = 1;

% load calibration data
data_location = ['data' filesep 'Demo_EmotivEPOC_EyeClose.set'];
opts.headModel = ['data' filesep 'head_models' filesep 'emotivHeadModel_file'];
opts.calibration_data = exp_eval_optimized(io_loadset(data_location, ...
        'markerchannel',{'remove_eventchns',false}));

% load 61-ch Flanker Task dataset
% calibData = exp_eval_optimized(io_loadset('D:\Matlab Coding\OnlineICA\BCILAB\userdata\Flanker_SH_cleaned_test_icainfo.set', ...
%     'markerchannel',{'remove_eventchns',false}));

% load 64-ch simulated dataset
% calibData = exp_eval_optimized(io_loadset('D:\Matlab Coding\OnlineICA\BCILAB\userdata\Colin27_Biosemi_1010_0_norot.set', ...
%     'markerchannel',{'remove_eventchns',false}));

% load 64-ch Cognionics Calibration Data
% calibData = exp_eval_optimized(io_loadset('D:\Matlab Coding\VisEEG\data\20141216_calib.set', ...
%     'markerchannel',{'remove_eventchns',false}));

% calibData.event = [];
% chanlocs = calibData.chanlocs;

% [filename, pathname] = uigetfile('*.set');

% select data
% calibData = set_selinterval(calibData, opts.calibEpoch);
% calibData = pop_loadset('data/EmotivTrain_EyeClose_icainfo.set');
opts.calibration_data = pop_select(opts.calibration_data,'time',[0 1]);
W = [];sphere = [];



if playback
    if exist('playbackStream','var')
        try
            stop(playbackStream)
            delete(playbackStream)
        end
    end
    EEG = pop_loadset(data_location);
    playbackStream = play_eegset_lsl(EEG,'REST_test_data','REST_test_markers',[],true);
end
REST(opts)

% if playback
%     stop(playbackStream)
%     delete(playbackStream)
% end